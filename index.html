<script src="https://maps.google.com/maps/api/js?key=AIzaSyAGL_Xc8z1fTp8Na-stxE9u8ihnjEbkbbA">

</script>
<script src="game-lib.js">
</script>
<script src="init.js">
</script>
<script src="view.js">
</script>
<script src="sprintf.js">
</script>
<script src="bounds.js">
</script>
<script src="tiles.js">
</script>
<link rel="stylesheet" type="text/css" href="style.css">

<button id="plus">+</button>
<button id="minus">-</button>
<button id="north">N</button>
<button id="south">S</button>
<button id="east">E</button>
<button id="west">W</button>
<button id="darker">darker</button>
<button id="lighter">lighter</button>
<button id="solar">solar</button>
<button id="landuse">landuse</button>

<div id="google_map" style="width:1200px; height:600px"></div>

<textarea id="box" cols=80 rows=25></textarea>


<label for="command">Command</label>
<input type="text" name="command" id="command">
<p>

  <div id="response"></div>

  <canvas id="game-canvas" width=1200px height=450px></canvas>
  <!-- <script src="google-map-stuff.js"></script> -->
  <script src="gametiles.js"></script>



  <script>
    // setup view
    const mapDiv = document.querySelector('#google_map');
    view.map = new google.maps.Map(mapDiv, myOptions);
    updateView(view);

    // setup buttons

    let buttons = document.querySelectorAll('button');
    for (var i = 0; i < buttons.length; i++) {
      buttons[i].addEventListener('click', viewController);
    }

    console.log(myOptions);

    // determine which websocket we connect to by looking at #

    var url = window.location.href;
    var tag = url.substring(url.indexOf('#') + 1, url.length);

    var ws;

    if (tag == "local") {
      ws = new WebSocket("ws://127.0.0.1:8000");
    } else {
      ws = new WebSocket("wss://ws.terramapadventure.com:443");
    }

    console.log(ws);

    let tileinfo = {};
    let userinfo = {};
    let tiledata = {};

    var output = document.getElementById("response");
    var tbox = document.querySelector('#box');
    tbox.disabled = true;

    ws.onmessage = function (event) {
      console.log(event);
      tbox.innerHTML += event.data + "\n";
    }

    var cmdLine = document.getElementById("command")
    cmdLine.addEventListener("keydown", command);

    function command(e) {
      if (e.key == "Enter") {
        var hash = {
          cmd: cmdLine.value,
          user: "barry"
        };
        ws.send(JSON.stringify(hash));
        cmdLine.value = "";
      }
    }
  </script>